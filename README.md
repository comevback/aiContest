## プロジェクト技術フロー概要

### 1. Redmine の起動とユーザー REST API キーの取得

ユーザーは Redmine にログインし、「個人設定」から REST API を有効化する。  
自分の API キーと Redmine URL を取得する。  
以降のすべての処理はこの二つの情報に依存する。
bundle exec rails s -e production -b 0.0.0.0 -p 3000

### 2. フロントエンド（React）の起動

フロントエンドディレクトリで `npm install` を実行し、必要な依存パッケージを導入する。  
続いて `npm run dev` を実行して開発用サーバーを起動する。  
ユーザーはブラウザからフロントエンド画面にアクセスする。

### 3. FastAPI バックエンドの起動

`uvicorn server:app --reload` を実行してバックエンドを起動する。  
FastAPI は環境変数を読み込み、Azure OpenAI クライアントを初期化し、フロントエンドからのリクエストを待機する。

### 4. フロントエンドで Redmine URL と API キーを入力

ユーザーはフロントエンド画面に Redmine URL と API キーを入力する。  
フロントエンドは全ての API リクエストのヘッダーにこの二つを付与する。

### 5. FastAPI による Redmine インスタンスの生成

バックエンドはヘッダーから Redmine URL と API キーを取得し、Redmine ライブラリを用いて認証を行う。  
認証済みインスタンスはキャッシュに保持され、重複認証を避ける。

### 6. プロジェクト一覧の取得

フロントエンドが `/api/projects` を要求する。  
バックエンドは `redmine.project.all()` を呼び出し、ユーザーがアクセス可能なプロジェクト一覧を返す。

### 7. プロジェクト内チケット一覧の取得

フロントエンドが `/api/projects/{project_id}/issues` を要求する。  
バックエンドは Redmine API を通じてチケットの状態、優先度、作成／更新日、期日などの情報を取得する。

### 8. フロントエンドでのデータ可視化

フロントエンドはチケット情報を基に、ステータス分布、優先度分布、最新チケットなどを可視化する。  
可視化はすべて Redmine からのデータに基づいて行われる。

### 9. プロジェクトの AI 分析

フロントエンドは `/api/analyze` にリクエストを送信する。  
バックエンドはすべてのチケット内容をまとめ、プロンプトとして Azure OpenAI に送信する。  
モデルの出力には、プロジェクト概要、リスク、改善提案などが含まれ、フロントエンドは Markdown として表示する。

### 10. プロジェクト全体の進捗予測

フロントエンドが `/api/projects/{project_id}/progress-prediction` を要求する。  
バックエンドは開始日、期日、完了チケット数を基に計画値、実績値、予測値を算出する。  
フロントエンドは折れ線グラフとして表示する。

### 11. 個別チケットの進捗予測

フロントエンドが `/api/issues/{issue_id}/progress-prediction` を要求する。  
バックエンドは期日の有無を確認し、ある場合は計画進捗、実績進捗、予測進捗を算出する。  
フロントエンドは折れ線グラフとして表示する。

### 12. データのエクスポート機能

フロントエンドはチケットデータを CSV または JSON としてエクスポートするための API を呼び出す。  
バックエンドは csv または json ライブラリを使用してファイル内容を生成し返却する。

### 13. 全体フローまとめ

1. Redmine を起動し API キーを取得
2. フロントエンドを起動
3. バックエンドを起動
4. URL と API キーを入力
5. Redmine との認証とインスタンス生成
6. プロジェクト一覧を取得
7. チケットデータを取得
8. フロントエンドで可視化
9. Azure OpenAI による分析
10. プロジェクト進捗の予測
11. 個別チケット進捗の予測
12. データエクスポート
